2025-05-26 19:41:04.582 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-26 19:41:04.638 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-05-26 19:41:04.686 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-05-26 19:41:04.693 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-26 19:41:04.694 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-26 19:41:04.703 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-05-26 19:41:04.724 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Users] ADD [IsActive] bit NOT NULL DEFAULT CAST(0 AS bit);
2025-05-26 19:41:04.726 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250526124049_AddIsActiveForUsers', N'9.0.5');
2025-05-26 19:41:04.729 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-05-26 19:41:16.863 +07:00 [INF] () Starting ChatApp API...
2025-05-26 19:41:17.337 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 19:41:17.340 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 19:41:17.558 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 19:41:17.560 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 19:41:17.561 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 19:50:32.099 +07:00 [INF] () Starting ChatApp API...
2025-05-26 19:50:32.430 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 19:50:32.433 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 19:50:32.510 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 19:50:32.511 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 19:50:32.512 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 19:57:17.803 +07:00 [INF] () Starting ChatApp API...
2025-05-26 19:57:18.121 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 19:57:18.124 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 19:57:18.195 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 19:57:18.197 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 19:57:18.199 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 20:54:51.886 +07:00 [INF] () Starting ChatApp API...
2025-05-26 20:54:52.178 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 20:54:52.181 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 20:54:52.262 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 20:54:52.264 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 20:54:52.266 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 20:55:57.587 +07:00 [INF] () Starting ChatApp API...
2025-05-26 20:55:58.011 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 20:55:58.014 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 20:55:58.126 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 20:55:58.127 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 20:55:58.128 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 20:56:22.389 +07:00 [INF] () Starting ChatApp API...
2025-05-26 20:56:22.730 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 20:56:22.733 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 20:56:22.817 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 20:56:22.818 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 20:56:22.819 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 21:01:03.943 +07:00 [INF] () Starting ChatApp API...
2025-05-26 21:01:04.269 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 21:01:04.274 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 21:01:04.353 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 21:01:04.355 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 21:01:04.356 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 21:20:35.833 +07:00 [INF] () Starting ChatApp API...
2025-05-26 21:20:36.151 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 21:20:36.154 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 21:20:36.228 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 21:20:36.230 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 21:20:36.231 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 21:20:37.816 +07:00 [INF] (Serilog.AspNetCore.RequestLoggingMiddleware) HTTP GET /healthcheck responded 200 in 64.0891 ms
2025-05-26 21:20:43.313 +07:00 [INF] (Serilog.AspNetCore.RequestLoggingMiddleware) HTTP GET /healthcheck responded 200 in 4.1739 ms
2025-05-26 21:20:43.443 +07:00 [INF] (Serilog.AspNetCore.RequestLoggingMiddleware) HTTP GET /favicon.ico responded 404 in 2.4071 ms
2025-05-26 21:20:59.306 +07:00 [INF] (ChatApp.Api.Controllers.AuthController) Initiating Google login. Client return URL: http://localhost:4200/auth-callback
2025-05-26 21:20:59.334 +07:00 [INF] (Serilog.AspNetCore.RequestLoggingMiddleware) HTTP GET /auth/login-google responded 302 in 203.1811 ms
2025-05-26 21:21:05.162 +07:00 [INF] (Serilog.AspNetCore.RequestLoggingMiddleware) HTTP GET /signin-google responded 302 in 420.9068 ms
2025-05-26 21:21:05.188 +07:00 [INF] (ChatApp.Api.Controllers.AuthController) Processing Google login response after external cookie authentication.
2025-05-26 21:21:05.191 +07:00 [INF] (ChatApp.Api.Controllers.AuthController) User claims extracted: Email=hoangnguyenn268@gmail.com, GoogleId=110932885050862021885, Name=Nguyên Hoàng
2025-05-26 21:21:06.418 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (105ms) [Parameters=[@__googleUserId_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[AvatarUrl], [u].[CreatedAtUtc], [u].[DisplayName], [u].[Email], [u].[ExternalId], [u].[IsActive], [u].[LastSeenUtc], [u].[ProviderName], [u].[UpdatedAtUtc]
FROM [Users] AS [u]
WHERE [u].[ExternalId] = @__googleUserId_0 AND [u].[ProviderName] = N'Google'
2025-05-26 21:21:06.451 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (4ms) [Parameters=[@__userEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[AvatarUrl], [u].[CreatedAtUtc], [u].[DisplayName], [u].[Email], [u].[ExternalId], [u].[IsActive], [u].[LastSeenUtc], [u].[ProviderName], [u].[UpdatedAtUtc]
FROM [Users] AS [u]
WHERE [u].[Email] = @__userEmail_0
2025-05-26 21:21:06.522 +07:00 [INF] (ChatApp.Api.Controllers.AuthController) Creating new user from Google login: hoangnguyenn268@gmail.com
2025-05-26 21:21:06.604 +07:00 [INF] (Microsoft.EntityFrameworkCore.Database.Command) Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 2048), @p2='?' (DbType = DateTime2), @p3='?' (Size = 256), @p4='?' (Size = 256), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = DateTime2), @p8='?' (Size = 50), @p9='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Id], [AvatarUrl], [CreatedAtUtc], [DisplayName], [Email], [ExternalId], [IsActive], [LastSeenUtc], [ProviderName], [UpdatedAtUtc])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
2025-05-26 21:21:06.614 +07:00 [INF] (ChatApp.Api.Controllers.AuthController) User "21c33099-ee6b-4e62-83a8-f7c51c0be4fa" (hoangnguyenn268@gmail.com) processed. JWT generation (TODO).
2025-05-26 21:21:06.618 +07:00 [INF] (ChatApp.Api.Controllers.AuthController) Redirecting to client: http://localhost:4200/auth-callback
2025-05-26 21:21:06.622 +07:00 [INF] (Serilog.AspNetCore.RequestLoggingMiddleware) HTTP GET /Auth/process-google-response responded 302 in 1450.1544 ms
2025-05-26 21:49:49.431 +07:00 [INF] () Starting ChatApp API...
2025-05-26 21:49:49.774 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: https://localhost:7247
2025-05-26 21:49:49.778 +07:00 [INF] (Microsoft.Hosting.Lifetime) Now listening on: http://localhost:5066
2025-05-26 21:49:49.850 +07:00 [INF] (Microsoft.Hosting.Lifetime) Application started. Press Ctrl+C to shut down.
2025-05-26 21:49:49.852 +07:00 [INF] (Microsoft.Hosting.Lifetime) Hosting environment: Development
2025-05-26 21:49:49.853 +07:00 [INF] (Microsoft.Hosting.Lifetime) Content root path: D:\ChatApp\src\ChatApp.Api
2025-05-26 21:49:56.720 +07:00 [INF] (ChatApp.Api.Controllers.AuthController) Initiating Google login. Client return URL: http://localhost:4200/auth-callback
2025-05-26 21:49:56.745 +07:00 [INF] (Serilog.AspNetCore.RequestLoggingMiddleware) HTTP GET /auth/login-google responded 302 in 1111.3654 ms
2025-05-26 21:49:59.879 +07:00 [ERR] (Serilog.AspNetCore.RequestLoggingMiddleware) HTTP GET /signin-google responded 500 in 450.7325 ms
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultSignInScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.SignInAsync(HttpContext context, String scheme, ClaimsPrincipal principal, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.RemoteAuthenticationHandler`1.HandleRequestAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2025-05-26 21:49:59.992 +07:00 [ERR] (ChatApp.Api.Middleware.ErrorHandlingMiddleware) Unhandled exception occurred while processing request /signin-google
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultSignInScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.SignInAsync(HttpContext context, String scheme, ClaimsPrincipal principal, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.RemoteAuthenticationHandler`1.HandleRequestAsync()
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at ChatApp.Api.Middleware.ErrorHandlingMiddleware.InvokeAsync(HttpContext context) in D:\ChatApp\src\ChatApp.Api\Middleware\ErrorHandlingMiddleware.cs:line 31
